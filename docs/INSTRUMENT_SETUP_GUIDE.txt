%% INSTRUMENT SETUP GUIDE
% Canonical setup scripts:
% - Recipe (worker engine): `demos/demo.m`
% - Recipe (worker engine, n/E example, no hardware required): `demos/demo_nE.m`
% - Legacy rack-on-client debug example (git-ignored): `tests/demo_nE.m`
%
% Keep the relevant demo(s) up to date when you add/change instruments/channels.
%
% QUICK REFERENCE
% ---------------
% 0) Add sm-dev or sm-main code folder to the MATLAB path
% 1) Run sminit (shared setup: globals, cleanup, UI state)
% 2) Create instrument object (handle)
% 3) Optional: set instrument properties / send direct hardware commands
% 4) Add instrument to rack
% 5) Add user-facing channels to rack
% 6) smready(rack)  OR  smready(recipe)
%
% STEP 0: Add sm-dev or sm-main code folder to the path
% This matches tests/demo_nE.m and keeps sminit available.
% Example:
%   username = string(getenv("USERNAME"));
%   sm_dev_path = fullfile("C:\Users", username, "Desktop", "sm-dev");
%   if exist(sm_dev_path, "dir")
%       codePath = fullfile(sm_dev_path, "code");
%       addpath(codePath);
%   end
%
% STEP 1: Run shared initialization
%   sminit;
%
% STEP 2: Create instrument object
% Syntax: handle = instrument_ClassName(address)
%
% Examples:
%   handle_clock = instrument_clock("clock");
%   handle_K2450 = instrument_K2450(gpibAddress(18, 0));
%   handle_SR830 = instrument_SR830(gpibAddress(7, 0));
%   handle_Montana2 = instrument_Montana2("192.168.1.100");
%
% STEP 3 (optional): configure instrument
% Common patterns:
%   handle.requireSetCheck = false;  % skip set verification for fast/unsafe cases
%   h = handle.communicationHandle;
%   writeline(h, "SCPI_COMMAND");
%   resp = writeread(h, "SCPI_QUERY?");
% Notes:
% - This can be done before or after rack.addInstrument(...) (demo.m does both).
% - Prefer instrument class methods when available; use direct commands for gaps.
% - Safety default: keep `reset()` calls commented out unless you have
%   explicitly ramped outputs to a known-safe state.
% - Framework write pacing is controlled by `handle.writeCommandInterval`
%   (default `seconds(0)`). No automatic GPIB delay is applied by default;
%   set this manually per instrument only when needed.
%
% STEP 4: add instrument to rack
% Syntax: rack.addInstrument(handle, "instName")
%
% Examples:
%   rack.addInstrument(handle_clock, "clock");
%   rack.addInstrument(handle_K2450, "K2450_A");
%
% STEP 5: add channels to rack (user-facing names used by smget/smset)
% Full signature (matches explicit-rack debug scripts like tests/demo_nE.m):
%   rack.addChannel("instName", "instChanName", "userChanName", rampRate, rampThreshold, softMin, softMax)
%
% Notes:
% - rampRate, rampThreshold, softMin, softMax are optional.
% - Use [] to skip an optional argument position.
% - softMin/softMax are enforced by instrumentRack (smset/rackSet) only.
%   Direct instrument.setChannel calls bypass these software limits.
%
% Examples:
%   rack.addChannel("clock", "timeStamp", "time");
%   rack.addChannel("K2450_A", "V_source", "V_bg", 1, 0.5, -10, 10);
%   rack.addChannel("SR830_1", "XTheta", "Ixx_XTheta");
%
% STEP 6: finish setup + launch GUI
%   smready(rack);
%
% RECIPE MODE (worker engine)
% ---------------------------
% For recipe-based setups (recommended), build an `instrumentRackRecipe` instead:
%   recipe = instrumentRackRecipe();
%   recipe.addInstrument("h", "instrument_ClassName", "friendlyName", ...);
%   recipe.addChannel("friendlyName", "instChanName", "userChanName");
%   recipe.addStatement("h = handle_myInst.communicationHandle;");
%   recipe.addStatement("writeline(h, ""SCPI_COMMAND"");");
%   smready(recipe);
%
% Statement style guideline:
% - Prefer one executable line per `recipe.addStatement(...)` call.
% - This makes it easy to comment out individual setup lines in demos/scripts.
%
% Optional local-debug path with the same recipe (no engine worker):
%   smready(recipe, singleThreaded = true);
%
% RACK SCRIPT -> RECIPE SCRIPT MIGRATION
% --------------------------------------
% Use this when converting a legacy main script that currently does:
%   rack = instrumentRack(...); ... smready(rack);
%
% 1) Replace rack construction:
%      rack = instrumentRack(true);
%   -> recipe = instrumentRackRecipe();
%
% 2) Convert each physical-instrument block:
%      handle_K2450 = instrument_K2450(gpibAddress(18, 0));
%      handle_K2450.requireSetCheck = false;
%      h = handle_K2450.communicationHandle;
%      writeline(h, ":OUTP ON");
%      rack.addInstrument(handle_K2450, "K2450_A");
%   -> recipe.addInstrument("handle_K2450", "instrument_K2450", "K2450_A", gpibAddress(18, 0));
%      recipe.addStatement("handle_K2450.requireSetCheck = false;");
%      recipe.addStatement("h = handle_K2450.communicationHandle;");
%      recipe.addStatement("writeline(h, ':OUTP ON');");
%
% 3) Convert channels 1:1:
%      rack.addChannel(...) -> recipe.addChannel(...)
%
% 4) Convert virtual-instrument construction:
%      handle_v = virtualInstrument_nE("virtual_nE", rack, ...);
%      rack.addInstrument(handle_v, "virtual_nE");
%   -> recipe.addVirtualInstrument("handle_v", "virtualInstrument_nE", "virtual_nE", "virtual_nE", ...);
%
% 5) Replace final setup call:
%      smready(rack);
%   -> smready(recipe);                         % worker engine default
%      smready(recipe, singleThreaded = true); % local debug with same recipe
%
% 6) If an instrument needs extra client workers, make it explicit in recipe:
%      recipe.addInstrument(..., numeWorkersRequested = N);
%
% COMMON PITFALLS
% --------------
% - addInstrument arg order is (handle, "instName"), not ("instName", handle).
% - The "instName" string must match between addInstrument and addChannel.
% - "instChanName" must exist in the instrument class (see its constructor/addChannel calls).
% - All names must be unique (instrument names, userChanName).

